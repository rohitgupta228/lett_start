!function ($) {
  var searchProducts = function () {

  }

  searchProducts.prototype.init = function () {
    var self = this;
    if ($.API) {
      var params = new URLSearchParams(window.location.search);
      var keyword = params.get('s');
      $("#search-keyword").html(keyword);
      $("#search-keyword").css("text-transform", "capitalize")
      $.API.getWithoutToken('product/search?category=' + keyword).then(function (data) {
        if (data.products.data.length) {
          self.generateHTML(data.products.data, "#themes-list");
        }
        else {
          $.API.getWithoutToken('product/home').then(function (list) {
            $("#themes-list").load("../../no-search-result.html", function(data, status, jqXGR){
              if(status === 'success'){
                self.generateHTML(list.bestSelling, "#popular-list");
              }
            });
          }).catch(function () {
            console.log("home API error");
          })
        }
      }).catch(function () {

      })
    }
  }

  searchProducts.prototype.generateHTML = function (resp, container) {
    $(container).html("");
    resp.forEach(function (elem) {
      var str = '';
      var img = elem.screenshot.split(".")[0];
      var type = elem.screenshot.split(".")[1];
      var smImg = elem.screenshot ? img+'-sm.'+type : 'loading.jpg'; 
      str += '<div class="col-md-6">' +
        '<div class="demo-item" id="' + elem.id + '">' +
        '<a href="theme/' + elem.detailLink + '" class="screenshot">' +
        '<img src="assets/images/slider-screenshot/' + elem.screenshot + '" srcset="assets/images/slider-screenshot/' + smImg + ' 766w, assets/images/slider-screenshot/' + elem.screenshot + ' 3000w" alt="' + elem.name + '" class="img-fluid w-100"  width="714" height="456"/>' +
        '</a>' +
        '<div class="action-btn">' +
        '<a href="theme/' + elem.detailLink + '#demos" title="Live Preview" class="btn btn-primary btn-sm">Live Preview</a>' +
        '</div>' +
        '<div class="theme-desc">' +
        '<div class="title">' +
        '<h3 class="h5"><a href="theme/' + elem.detailLink + '" title="' + elem.name + '">' + elem.name + '</a></h3>' +
        '<p class="font-size-14">' + elem.oneLinerDesc + '</p>' +
        '</div>' +
        '<div class="price">' +
        '<h4 class="font-weight-bold">$' + elem.price + '</h4>' +
        '<a class="category" href="' + elem.catLink + '">' + elem.mainCat + '</a>' +
        '</div>' +
        '</div>' +
        '</div>' +
        '</div>';
      var item = $.parseHTML(str);
      if (elem.category && elem.category.indexOf("angular") > -1) {
        $(item).find(".screenshot").append("<div class='icon'><i class='bx bxl-angular'></i></div>")
      }
      $(container).append(item);
    });
  }

  $.searchProducts = new searchProducts, $.searchProducts.Constructor = searchProducts
}(window.jQuery),
  function ($) {
    "use strict";
    $.searchProducts.init();
  }(window.jQuery);