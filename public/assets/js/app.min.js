!function ($) {
  var App = function () {
  }

  //init app
  App.prototype.init = function () {
    //end test code
    var pageUrl = window.location.href.split(/[?#]/)[0];
    this.hideLoader()
    var self = this;
    if ($('.accordion .collapse').length) {
      $('.accordion .collapse').on('show.bs.collapse', function () {
        $(this).parents(".card").addClass("active")
      })
      $('.accordion .collapse').on('hide.bs.collapse', function () {
        $(this).parents(".card").removeClass("active")
      })
    }
    if($(".back-top").length) {
      $(".back-top").on("click", function() {
        $("html, body").animate({
          scrollTop: 0
        }, 500)
      })
    }
    $("#support-link").on("click", function () {
      if (localStorage.getItem('token') !== null) {
        var pathname = window.location.pathname.split("/");
        var url = "support.html";
        // if(pathname.includes('theme')) {
        //   url = "../"+url;
        // }
        window.location.href = url
      }
      else {
        $("#loginModal").modal('show');
      }
    })
    $(".navbar-header .navbar-toggler").on("click", function(){
      var target = $(this).attr("data-target");
      $(target).slideToggle().removeClass("collapse");
    });

    //Change profile image click
    $("#choose-file").on("click", function () {
      $("#upload-image").trigger('click');
    });

    if($('#resetModal').length){
      $('#resetModal').on('hide.bs.modal', function () {
        window.history.pushState({}, "", window.location.origin + window.location.pathname);
      });
    }

    // loader
    $(".header .navbar-nav .nav-link").each(function () {
      if (this.href == pageUrl) {
        $(this).addClass("active");
      }
    });

    $(".password-group .icon-view").on("click", function () {
      $(this).parent().toggleClass('active');
      var input = $(this).siblings('input');
      if(input.attr('type').toLowerCase() === 'text') {
        input.attr('type', 'password');
      }
      else {
        input.attr('type', 'text');
      }
    });

    $('.modal').modal({backdrop: 'static', keyboard: false, show: false})  

    $("#forgot-btn").on("click", function () {
      $(".auth-modal").modal('hide');
      $("#forgotModal").modal('show');
    })

    $("#register-btn").on("click", function () {
      $(".auth-modal").modal('hide');
      $("#registerModal").modal('show');
    })

    $("#login-btn, #forgot-login-btn, #auth-btn").on("click", function () {
      $(".auth-modal").modal('hide');
      $("#loginModal").modal('show');
    })

    //mobile menu
    $(".header .navbar-nav .dropdown-item").each(function () {
      if (this.href == pageUrl) {
        $(this).addClass("active");
        $(this).parents('.dropdown-menu').siblings(".nav-link").addClass('active');
      }
    });

    //upload profile image
    $("#upload-image").on("change", function () {
      $("#choose-file").find("span").hide();
      $("#choose-file").find(".btn-loader").show();
      var file = this.files[0];
      self.loadImg(file, this)
    })

    $("#search-form").on("submit", function() {
      var keyword = $(this).find(".form-control").val();
      var param = new URLSearchParams();
      param.append("s", keyword);
      window.location.href="search-result?"+param;
    })

    //init service worker
    this.initServiceWorker();

    //hide error
    this.messages();

    //get user profile details
    this.getUserDetails();


    //logout current user;
    this.logout();

    //window scroll method
    this.windowScroll();
  }

  //init service worker
  App.prototype.initServiceWorker = function () {
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.min.js')
        .then(function (reg) {
          console.log('service worker registered')
        })
        .catch(function (err) {
          console.log('service worker not registered', err)
        });
    }
  }

  //close error msgs
  App.prototype.messages = function () {
    if ($(".error-msgs").length) {
      $(document).on('click', ".error-msgs .close", function () {
        $(this).parents(".error-msgs").find("p").remove();
        $(this).parent().hide();
      })
    }
    if ($(".success-msgs").length) {
      $(document).on('click', ".success-msgs .close", function () {
        $(this).parents(".success-msgs").find("p").remove();
        $(this).parent().hide();
      })
    }
  }

  //logout user
  App.prototype.logout = function () {
    var self = this;
    $("#logout-btn").on("click", function () {
      self.showContentLoader($("#logged-user").find('.loader-wrap'));
      self.logoutUser();
    })
  }

  //show profile image method
  App.prototype.loadImg = function (file, self) {
    var img, instance = this;
    var defaultImg= "assets/images/client-thumb.png";
    if (file) {
      var type = file.name.match(/.(jpg|jpeg|png|gif)$/i);
      if (!type) {
        instance.showError(self, "Please choose valid file", "alert-success", "alert-danger");
        $("#choose-file").find("span").show();
        $("#choose-file").find(".btn-loader").hide();
        return;
      }
      $(self).parents("form").find(".error-msgs").hide();
      img = new Image();
      img.onload = function () {
        if (this.width > 160) {
          var msg = "The file is too large. Allowed maximum size of 160 X 160";
          console.log(window.currentuser);
          $(".profile-image img").hide();
          $(".profile-image img").attr("src", defaultImg).show()
          instance.showError(self, msg, "alert-success", "alert-danger");
          $("#choose-file").find("span").show();
          $("#choose-file").find(".btn-loader").hide();
          return;
        }
        else {
          instance.uploadImage(file, self)
        }
      };
      img.onerror = function () {
        error = {
          flag: true,
          msg: "Image load error"
        }
      };
      img.src = window.URL.createObjectURL(file);
      img.style.display = "none";
      $(".profile-image img").attr("src", window.URL.createObjectURL(file))
    }
  }

  //change profile image
  App.prototype.uploadImage = function (file, self) {
    var instance = this;
    var formData = new FormData();
    formData.append("image", file);
    if($.API){
      var prom = $.API.profilePic('user/upload/profile-image', formData);
      prom.then(function(data) {
        var msg = "Image uploaded successfully";
        instance.showError(self, msg, "alert-danger", "alert-success");
        $("#choose-file").find("span").text("Change Profile Image")
      }).catch(function(error) {
        if (error.responseJSON && error.responseJSON.code === 401) {
          var msg = "Image upload failed";
          instance.showError(self, msg, "alert-success", "alert-danger");
          $(".profile-image img").attr("src", window.currentuser.user_details.image)
        }
        else {
          var msg = "Please signin to update profile";
          instance.showError(self, msg, "alert-success", "alert-danger");
          $("#choose-file").find("span").show();
          $("#choose-file").find(".btn-loader").hide();
        }
      }).finally(function(){
        $("#choose-file").find("span").show();
        $("#choose-file").find(".btn-loader").hide();
      })
    }
  }

  //show error
  App.prototype.showError = function (currentElem, msg, removeClasses, addClasses) {
    $(currentElem).parents("form").find(".error-msgs").find("p").remove();
    $(currentElem).parents("form").find(".error-msgs").removeClass(removeClasses).addClass(addClasses).append("<p>" + msg + "</p>").fadeIn(200);
  }

  //show fakeloader
  App.prototype.showLoader = function () {
    $(".fakeLoader").show();
  }

  //hide fakeloader
  App.prototype.hideLoader = function () {
    $(".fakeLoader").hide();
  }

  //show fakeloader
  App.prototype.showContentLoader = function (elem) {
    $(elem).addClass('show');
  }

  //hide fakeloader
  App.prototype.hideContentLoader = function (elem) {
    $(elem).removeClass('show');
  }

  /**
   * Get current user details
   */
  App.prototype.getUserDetails = function () {
    var instance = this;
    if($.API){
      instance.showContentLoader($("#auth-btn").parent().find('.loader-wrap'));
      var prom = $.API.get('user/details');
      prom.then(function(data) {
        if (data && data.hasOwnProperty('user')) {
          instance.fillProfile(data.user);
        }
      }).catch(function(error) {
        if(error.responseJSON && error.responseJSON.code === 401) {
          localStorage.clear();
        }
      }).finally(function(){
        instance.hideContentLoader($("#auth-btn").parent().find('.loader-wrap'));
      })
    }
  }

  /**
   * Fill profile data
   */
  App.prototype.fillProfile = function (userDetails) {
    $("#auth-btn").parent().hide();
    $("#logged-user").fadeIn(200);
    var imgURL = "assets/images/client-thumb.png";
    var pathname = window.location.pathname.split("/");
    if(pathname.includes('theme')) {
      imgURL = "../"+imgURL;
    }
    window.currentuser = userDetails;
    if (userDetails && userDetails.user_details && userDetails.user_details.image) {
      imgURL = userDetails.user_details.image;
    }
    $("#logged-user").find(".dropdown-toggle img").attr("src", imgURL);
    if (window.currentuser){
      if ($("#edit-user-name").length && $("#edit-user-email").length) {
        $("#edit-user-name").val(window.currentuser.username);
        $("#edit-user-email").val(window.currentuser.email);
      }
    }
    if (window.currentuser.user_details) {
      if ($(".profile-image img").length) {
        if (window.currentuser.user_details.image) {
          $(".profile-image img").attr("src", window.currentuser.user_details.image);
        }
        $("#choose-file").children().first().text("Change Profile Image");
      }
      if ($("#edit-profile-form").length) {
        $("#edit-profile-form").find(".form-control").each(function () {
          var key = $(this).attr("name");
          var value = window.currentuser.user_details[key];
          if (value) {
            $(this).val(value);
            $(this).parent(".app-label").addClass("up");
          }
          else {
            $(this).val("")
          }
        })
      }
    }
  }

  /**
   * logout user details
   */
  App.prototype.logoutUser = function () {
    var self = this;
    if($.API){
      var prom = $.API.get('user/logout');
      prom.then(function(data) {
        $("#logged-user").hide();
        $("#auth-btn").parent().fadeIn(200);
        localStorage.clear();
        window.location.reload()
      }).catch(function(error) {
        console.log("logout user error -->", error);
      }).finally(function() {
        self.hideContentLoader($("#logged-user").find('.loader-wrap'));
      })
    }
  }

  /**
   * ----------------------------------------------
   * Nav Scroll active section class 
   * ----------------------------------------------
   */
  App.prototype.windowScroll = function () {
    //get document height
    var docHeight = $(document).outerHeight();
    $(window).on('scroll', function () {
      var scrollPos = $(this).scrollTop();
      if (scrollPos >= 20) {
        $(".header").addClass("fixed-nav");
      } else {
        $(".header").removeClass("fixed-nav");
      }
      if (scrollPos > docHeight / 2) {
        $(".back-top").addClass("show");
      }
      else {
        $(".back-top").removeClass("show");
      }
    })
  }

  //init App
  $.App = new App, $.App.Constructor = App
}(window.jQuery),
//initializing App
function ($) {
  "use strict";
  $.App.init();
}(window.jQuery);

!function ($) {
  var Auth = function () { };
  //init auth
  Auth.prototype.init = function () {
    this.validateLogin();
    this.validateRegister();
    this.validateForgot();
    this.validateReset();
  }
  //validate login form
  Auth.prototype.validateLogin = function () {
    if ($('#login-form').length) {
      $('#login-form').validate({
        focusInvalid: false,
        rules: {
          'username': {
            required: true
          },
          'password': {
            required: true,
          },
          'validation-required': {
            required: true
          }
        },
        errorPlacement: function errorPlacement(error, element) {
          $(element).siblings(".validation-error").removeClass("d-none");
          return true
        },
        highlight: function (element) {
          var $el = $(element);
          var $parent = $el.parents('.form-group');
          $parent.addClass("invalid-field");
        },
        unhighlight: function (element) {
          var $el = $(element);
          var $parent = $el.parents('.form-group');
          $parent.removeClass("invalid-field");
          $(element).siblings(".validation-error").addClass("d-none");
        }
      });
    }
  }
  //validate register form
  Auth.prototype.validateRegister = function () {
    if ($('#signup-form').length) {
      $('#signup-form').validate({
        focusInvalid: false,
        rules: {
          'username': {
            required: true
          },
          'email': {
            required: true
          },
          'password': {
            required: true,
            minlength: 6,
            maxlength: 32
          },
          'password_confirmation': {
            required: true,
            equalTo: "#password_primary"
          },
          'validation-required': {
            required: true
          }
        },
        errorPlacement: function errorPlacement(error, element) {
          if(error[0].innerText === 'Please enter a valid email address.'){
            $(element).siblings(".validation-error").text(error[0].innerText).removeClass("d-none");
          }
          else if ($(error[0]).text() === 'Please enter the same value again.') {
            $(element).siblings(".validation-error").removeClass("d-none").text("Password and confirm password should be same");
          }
          else if ($(error[0]).text() === 'Please enter at least 6 characters.' || $(error[0]).text() === 'Please enter no more than 32 characters.') {
            $(element).siblings(".validation-error").removeClass("d-none").text($(error[0]).text());
          }
          else {
            $(element).siblings(".validation-error").addClass("d-none");
          }
          return true
        },
        highlight: function (element) {
          var $el = $(element);
          var $parent = $el.parents('.form-group');
          $parent.addClass("invalid-field")
        },
        unhighlight: function (element) {
          var $el = $(element);
          var $parent = $el.parents('.form-group');
          $parent.removeClass("invalid-field");
          $(element).siblings(".validation-error").addClass("d-none");
        }
      });
      // $('#signup-form').submit(function(e){
      //   e.preventDefault();
      //   if($.API){
      //     var prom = $.API.postWithoutToken('user/signup', payload);
      //     prom.then(function(resp) {
      //       $('#signup-form').reset();
      //       if (resp && resp.hasOwnProperty('token')) {
      //         var tokenOriginal = resp.token.original;
      //         localStorage.setItem("token", tokenOriginal.access_token);
      //         window.location.href = "/"
      //       }
      //     }).catch(function(error) {
      //       if (error && error.responseJSON) {
      //         var resp = error.responseJSON;
      //         if ((resp.code && resp.code === 400) && resp.error) {
      //           var errorMsg = resp.error
      //           for (var i in errorMsg) {
      //             var pelem = "<p>" + errorMsg[i] + "</p>";
      //             $('#signup-form').find("#errorMsg").append(pelem);
      //           }
      //           $('#signup-form').find("#errorMsg").fadeIn(200);
      //         }
      //       }
      //     }).finally(function(){
      //       $('#signup-form').find("[type = 'submit']").removeClass("disable-events");
      //     })
      //   }
      // })
    }
  }
  //validate forgot form
  Auth.prototype.validateForgot = function () {
    if ($('#forgot-form').length) {
      $('#forgot-form').validate({
        focusInvalid: false,
        rules: {
          'email': {
            required: true,
            email: true
          },
          'validation-required': {
            required: true
          }
        },
        errorPlacement: function errorPlacement(error, element) {
          $(element).siblings(".validation-error").removeClass("d-none");
          return true
        },
        highlight: function (element) {
          var $el = $(element);
          var $parent = $el.parents('.form-group');
          $parent.addClass("invalid-field")
        },
        unhighlight: function (element) {
          var $el = $(element);
          var $parent = $el.parents('.form-group');
          $parent.removeClass("invalid-field");
          $(element).siblings(".validation-error").addClass("d-none");
        },
        submitHandler: function (form) {
          $(form).find("[type = 'submit']").addClass("disable-events");
          var payload = convertSerializeObj($(form).serializeArray())
          if($.API){
            var prom = $.API.postWithoutToken('user/forgot-password', payload);
            prom.then(function(data) {
              console.log("data ==>", data);
              $(form)[0].reset();
              if (data.message === "User not found") {
                $(form).find("#successMsg").find("p").remove();
                $(form).find("#successMsg").removeClass("alert-success").addClass("alert-danger").append("<p>Email id not match with our records.</p>");
              }
              else {
                $(form).find("#successMsg").find("p").remove();
                $(form).find("#successMsg").removeClass("alert-danger").addClass("alert-success").append("<p>Reset password mail has been send to your email address.</p>");
              }
              $(form).find("#successMsg").fadeIn(200);
            }).catch(function(error) {
              if (err && err.responseJSON) {
                var resp = err.responseJSON;
                if ((resp.code && resp.code === 400) && resp.error) {
                  $(form).find("#errorMsg").append("<p>Email id not match with our records. Please contact admin in case your are facing any issue.</p>");
                  $(form).find("#errorMsg").fadeIn(200);
                }
              }
            }).finally(function(){
              $(form).find("[type = 'submit']").removeClass("disable-events");
            })
          }
        }
      });
    }
  }
  //validate reset form
  Auth.prototype.validateReset = function () {
    if ($('#reset-form').length) {
      $('#reset-form').validate({
        focusInvalid: false,
        rules: {
          'password': {
            required: true,
            minlength: 6,
            maxlength: 32
          },
          'password_confirmation': {
            required: true,
            equalTo: "#password_reset"
          },
          'validation-required': {
            required: true
          }
        },
        errorPlacement: function errorPlacement(error, element) {
          if ($(error[0]).text() === 'Please enter the same value again.') {
            $(element).siblings(".validation-error").removeClass("d-none").text("Password and confirm password should be same");
          }
          $(element).siblings(".validation-error").removeClass("d-none");
          return true
        },
        highlight: function (element) {
          var $el = $(element);
          var $parent = $el.parents('.form-group');
          $parent.addClass("invalid-field")
        },
        unhighlight: function (element) {
          var $el = $(element);
          var $parent = $el.parents('.form-group');
          $parent.removeClass("invalid-field");
          $(element).siblings(".validation-error").addClass("d-none");
        },
        submitHandler: function (form) {
          $(form).find("[type = 'submit']").addClass("disable-events");
          var param = new URLSearchParams(window.location.search);
          var token = param.get('token');
          var email = param.get('email');
          if ((email && email.length) && (token && token.length)) {
            var payload = convertSerializeObj($(form).serializeArray());
            payload.token = token;
            payload.email = email;
            if($.API){
              var prom = $.API.postWithoutToken('user/reset-password', payload);
              prom.then(function(data) {
                $(form)[0].reset();
                $(form).find("#successMsg").append("<p>Password reset successfully. Please signin again.</p>");
                $(form).find("#successMsg").fadeIn(200);
                setTimeout(function () {
                  window.location.href = "index.html"
                }, 5000)
              }).catch(function(error) {
                if (error && error.responseJSON) {
                  var resp = error.responseJSON;
                  if ((resp.code && resp.code === 400) && resp.error) {
                    $(form).find(".error-msgs").append("<p>Link has been expired.</p>");
                    $(form).find(".error-msgs").fadeIn(200);
                  }
                }
              }).finally(function(){
                $(form).find("[type = 'submit']").removeClass("disable-events");
              })
            }
          }
        }
      });
    }
  }
  //init App
  $.Auth = new Auth, $.Auth.Constructor = Auth
}(window.jQuery),
//initializing App
function ($) {
  "use strict";
  $.Auth.init();
}(window.jQuery);

!function ($) {
  var Theme = function(){}
  Theme.prototype.init = function () {
    this.licenceRadio();
    this.paymentRadio();
  }
  Theme.prototype.licenceRadio = function () {
    $("#licence-types li").on("click", function () {
      $(this).addClass("selected").siblings().removeClass("selected");
      var id = $(this).attr("data-tab");
      // if (id === 'multiple') {
      //   window.currentPck.multiple = true
      // }
      // if (id === 'single') {
      //   window.currentPck.multiple = false
      // }
      $("[data-id = " + id + "]").fadeIn().siblings().hide();
    })
  }
  Theme.prototype.paymentRadio = function() {
    $("#options .pay-btn").on('click', function () {
      var id = $(this).attr('button-selection');
      var payType = $(this).attr('payment-type');
      $(this).addClass('selected').siblings().removeClass('selected');
      $("#option-data").find('[data-id=' + id + ']').addClass('active show').attr('payment-type', payType).siblings().removeClass('active show');
    })
  }
  $.Theme = new Theme, $.Theme.Constructor = Theme
}(window.jQuery),

function ($){
  "use strict";
  $.Theme.init();
}(window.jQuery);

function convertSerializeObj(formData) {
  var payload = {}
  formData.forEach(function(item){
    payload[item.name] = item.value;
  })
  return payload
}